<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Produtos - Minha Loja</title>
  
  <!-- Estilos do Reveal.js -->
  <link rel="stylesheet" href="https://unpkg.com/reveal.js/dist/reveal.css">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js/dist/theme/white.css">
  
  <style>
    /* Estilos gerais e do cabeÃ§alho */
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f4f4;
    }
    header {
      background: #007BFF;
      color: white;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header .logo h2 {
      margin: 0;
    }
    .auth-area {
      display: flex;
      align-items: center;
    }
    .auth-area a {
      margin-left: 10px;
      color: white;
      text-decoration: none;
    }

    /* Estilos do slideshow */
    .reveal .slides {
      text-align: center;
    }
    .product-slide {
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 70vh;
    }
    .product-slide img {
      max-width: 100%;
      max-height: 50vh;
      object-fit: contain;
      margin-bottom: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .product-info {
      text-align: center;
    }
    .product-slide button {
      padding: 12px 24px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-size: 1.2em;
      transition: transform 0.2s;
    }
    .product-slide button:hover {
      background: #218838;
      transform: scale(1.05);
    }

    /* Estilos do Modal do Carrinho */
    #cartModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    #cartModal .modal-content {
      background: white;
      padding: 30px;
      border-radius: 10px;
      width: 90%;
      max-width: 600px;
    }
    #cartItems div {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #eee;
    }
  </style>
  
  <!-- SDK do Parse -->
  <script src="https://unpkg.com/parse/dist/parse.min.js"></script>
</head>
<body>
  <header>
    <div class="logo">
      <h2>Minha Loja</h2>
    </div>
    <div class="auth-area">
      <a href="index.html">Home</a>
      <a href="#" id="cartLink">Carrinho</a>
    </div>
  </header>

  <!-- Slideshow de Produtos -->
  <div class="reveal">
    <div class="slides" id="productsSlides">
      <section class="product-slide">
        <h2>Carregando produtos...</h2>
      </section>
    </div>
  </div>

  <!-- Modal do Carrinho de Compras -->
  <div id="cartModal">
    <div class="modal-content">
      <h2>ðŸ›’ Carrinho de Compras</h2>
      <div id="cartItems"></div>
      <div style="margin-top: 20px;">
        <strong>Total: R$ <span id="cartTotal">0.00</span></strong>
      </div>
      <button id="closeCartBtn" style="margin-top: 20px;">Continuar Comprando</button>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://unpkg.com/reveal.js/dist/reveal.js"></script>
  <script>
    // Inicializa o Parse
    Parse.initialize("TYP8SUA8qxmHIRs1mHbiFalgRxCEf51sOiSWmNEY", "n4Gfko9sO7jiAUnWX5U5GGCDQ5QtPWX97K4TzB8I");
    Parse.serverURL = "https://parseapi.back4app.com";

    let cart = [];
    let revealInstance = null;

    // Carrega os produtos do Parse
    async function loadProducts() {
      const Produto = Parse.Object.extend("Produto");
      const query = new Parse.Query(Produto);
      
      try {
        const results = await query.find();
        const slidesContainer = document.getElementById('productsSlides');
        slidesContainer.innerHTML = '';

        results.forEach(produto => {
          const slide = document.createElement('section');
          slide.className = 'product-slide';
          const imgUrl = (produto.get("imagens") && produto.get("imagens")[0]) || 'https://via.placeholder.com/500x300?text=Sem+Imagem';
          
          slide.innerHTML = `
            <img src="${imgUrl}" alt="${produto.get("nome")}">
            <div class="product-info">
              <h3>${produto.get("nome")}</h3>
              <p>R$ ${parseFloat(produto.get("preco")).toFixed(2)}</p>
              <button onclick="addToCart('${produto.id}', '${produto.get("nome")}', ${produto.get("preco")})">
                Adicionar ao Carrinho
              </button>
            </div>
          `;
          slidesContainer.appendChild(slide);
        });

        initReveal();
      } catch (error) {
        console.error("Erro ao carregar produtos: ", error);
      }
    }

    // Inicializa o Reveal.js
    function initReveal() {
      if (revealInstance) revealInstance.destroy();
      
      revealInstance = new Reveal({
        hash: true,
        loop: true,
        autoSlide: 5000,
        autoSlideStoppable: false,
        transition: 'slide',
        controls: true,
        progress: true
      });
      
      revealInstance.initialize();
    }

    // FunÃ§Ãµes do Carrinho (mantidas as originais com melhorias)
    function addToCart(id, name, price) {
      cart.push({ id, name, price: parseFloat(price) });
      alert(`âœ… ${name} adicionado ao carrinho!`);
    }

    document.getElementById("cartLink").addEventListener("click", (e) => {
      e.preventDefault();
      renderCart();
      document.getElementById("cartModal").style.display = "flex";
    });

    function renderCart() {
      const cartItemsDiv = document.getElementById("cartItems");
      cartItemsDiv.innerHTML = "";
      let total = 0;
      
      cart.forEach((item, index) => {
        total += item.price;
        const itemDiv = document.createElement('div');
        itemDiv.innerHTML = `
          <span>${item.name} - R$ ${item.price.toFixed(2)}</span>
          <button onclick="removeFromCart(${index})" style="color: red; border: none; background: none">Ã—</button>
        `;
        cartItemsDiv.appendChild(itemDiv);
      });
      
      document.getElementById("cartTotal").textContent = total.toFixed(2);
    }

    function removeFromCart(index) {
      cart.splice(index, 1);
      renderCart();
    }

    document.getElementById("closeCartBtn").addEventListener("click", () => {
      document.getElementById("cartModal").style.display = "none";
    });

    // InicializaÃ§Ã£o
    loadProducts();
  </script>
</body>
</html>
