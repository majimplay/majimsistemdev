<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Frete</title>
    <style>
        /* Estilos mantidos do anterior */
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        .container { background: #f5f5f5; padding: 20px; border-radius: 8px; }
        input, button { padding: 10px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #4CAF50; color: white; cursor: pointer; }
        button:hover { background: #45a049; }
        .error { color: red; display: none; }
        .result { margin-top: 20px; padding: 15px; background: white; border-radius: 4px; }
        .loader { /* manter animação igual */ }
    </style>
</head>
<body>
    <div class="container">
        <h1>Calculadora de Frete</h1>
        <input type="text" id="cep" placeholder="Digite o CEP (ex: 01001000)" maxlength="9">
        <button onclick="calcularFrete()">Calcular</button>
        <div id="cepError" class="error"></div>
        <div class="loader" id="loader"></div>
        <div id="result" class="result"></div>
    </div>

    <script>
        // Configurações (SUBSTITUIR COM SEUS DADOS)
        const CONFIG = {
            APP_ID: 'TYP8SUA8qxmHIRs1mHbiFalgRxCEf51sOiSWmNEY',
            JS_KEY: 'n4Gfko9sO7jiAUnWX5U5GGCDQ5QtPWX97K4TzB8I',
            ENDPOINT: 'https://parseapi.back4app.com/functions/calcularFrete'
        };

        async function calcularFrete() {
            const cep = document.getElementById('cep').value.replace(/\D/g, '');
            const errorDiv = document.getElementById('cepError');
            const loader = document.getElementById('loader');
            const resultDiv = document.getElementById('result');

            // Resetar exibição
            errorDiv.style.display = 'none';
            resultDiv.innerHTML = '';
            loader.style.display = 'block';

            try {
                // Validar CEP no client-side
                if (cep.length !== 8) {
                    throw new Error('CEP deve conter 8 dígitos');
                }

                // Fazer requisição
                const response = await fetch(CONFIG.ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'X-Parse-Application-Id': CONFIG.APP_ID,
                        'X-Parse-JavaScript-Key': CONFIG.JS_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ cepDestino: cep })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Erro desconhecido');
                }

                exibirResultados(data.data);

            } catch (error) {
                errorDiv.textContent = error.message;
                errorDiv.style.display = 'block';
                resultDiv.innerHTML = '';
            } finally {
                loader.style.display = 'none';
            }
        }

        function exibirResultados(servicos) {
            let html = '<h3>Opções de Frete:</h3>';
            
            if (!servicos || servicos.length === 0) {
                html = '<p>Nenhuma opção disponível para este CEP</p>';
            } else {
                servicos.forEach(servico => {
                    html += `
                        <div class="servico">
                            <strong>${servico.empresa}</strong><br>
                            <span>${servico.metodo}</span><br>
                            Prazo: ${servico.prazo} dias<br>
                            Preço: R$ ${servico.preco.toFixed(2).replace('.', ',')}
                        </div>
                        <hr>
                    `;
                });
            }

            document.getElementById('result').innerHTML = html;
        }
    </script>
</body>
</html>
