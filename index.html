<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <!-- ... (mantive o head original igual) ... -->
  <style>
    /* Novos estilos adicionados */
    .order-controls {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-right: 10px;
    }
    .order-btn {
      padding: 4px;
      background: #2196F3;
      color: white;
      border: none;
      border-radius: 3px;
      cursor: pointer;
    }
    .address-form {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      z-index: 1000;
      display: none;
    }
    .address-form.show {
      display: block;
    }
    .toggle-address {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 8px 16px;
      background: #666;
      color: white;
      border: none;
      border-radius: 20px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <!-- ... (mantive o conteúdo original igual) ... -->

  <!-- Adicione isto antes do script Parse -->
  <button class="toggle-address" onclick="toggleAddressForm()">Alterar CEP/Endereço</button>
  
  <div class="address-form" id="addressForm">
    <h3>Configurações de Endereço</h3>
    <form id="addressFormContent">
      <input type="text" id="cep" placeholder="CEP" required>
      <input type="text" id="endereco" placeholder="Endereço" required>
      <input type="text" id="numero" placeholder="Número">
      <input type="text" id="cidade" placeholder="Cidade" required>
      <button type="submit" class="btn btn-edit">Salvar</button>
    </form>
  </div>

  <script>
    /* Funções novas adicionadas */
    function toggleAddressForm() {
      document.getElementById('addressForm').classList.toggle('show');
    }

    // Modificação no carregamento de produtos para ordenação
    async function loadProducts() {
      const query = new Parse.Query(Produto);
      query.ascending("order"); // Nova ordem
      try {
        const results = await query.find();
        updateTable(results);
      } catch (error) {
        alert("Erro ao carregar produtos: " + error.message);
      }
    }

    // Modificação no submit para adicionar no início
    document.getElementById('productForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      // ... (código existente) ...
      
      // Nova lógica de ordenação
      const countQuery = new Parse.Query(Produto);
      const count = await countQuery.count();
      produto.set("order", count + 1); // Novo campo para ordenação
      
      // ... (restante do código existente) ...
    });

    // Funções para mover produtos
    async function moveProductUp(id) {
      const query = new Parse.Query(Produto);
      const currentProduct = await query.get(id);
      const currentOrder = currentProduct.get("order");
      
      const prevQuery = new Parse.Query(Produto);
      prevQuery.lessThan("order", currentOrder);
      prevQuery.descending("order");
      const prevProduct = await prevQuery.first();
      
      if(prevProduct) {
        const prevOrder = prevProduct.get("order");
        currentProduct.set("order", prevOrder);
        prevProduct.set("order", currentOrder);
        await currentProduct.save();
        await prevProduct.save();
        loadProducts();
      }
    }

    async function moveProductDown(id) {
      const query = new Parse.Query(Produto);
      const currentProduct = await query.get(id);
      const currentOrder = currentProduct.get("order");
      
      const nextQuery = new Parse.Query(Produto);
      nextQuery.greaterThan("order", currentOrder);
      nextQuery.ascending("order");
      const nextProduct = await nextQuery.first();
      
      if(nextProduct) {
        const nextOrder = nextProduct.get("order");
        currentProduct.set("order", nextOrder);
        nextProduct.set("order", currentOrder);
        await currentProduct.save();
        await nextProduct.save();
        loadProducts();
      }
    }

    // Modificação na tabela para incluir controles de ordem
    function updateTable(produtos) {
      // ... (código existente) ...
      
      tr.innerHTML = `
        <td>
          <div class="order-controls">
            <button class="order-btn" onclick="moveProductUp('${produto.id}')">↑</button>
            <button class="order-btn" onclick="moveProductDown('${produto.id}')">↓</button>
          </div>
          <div class="image-gallery">${imagemHtml}</div>
          ${!readOnly ? `<button class="btn btn-edit" onclick="addImage('${produto.id}')">Adicionar Imagem</button>` : ''}
        </td>
        <!-- ... (restante das colunas) ... -->
      `;
      
      // ... (restante do código existente) ...
    }

    // Adicione segurança nos links
    function editProduct(id) {
      window.location.href = `editar.html?id=${id}`;
      // Se usar target="_blank" adicione:
      // rel="noopener noreferrer"
    }
  </script>
</body>
</html>
