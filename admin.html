<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Painel Admin</title>
    <script src="https://unpkg.com/parse/dist/parse.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .admin-panel {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="admin-panel hidden" id="adminContent">
        <h1>Painel Administrativo</h1>
        <p>Bem-vindo, <span id="adminUsername"></span>!</p>
        <h3>Estat√≠sticas:</h3>
        <div id="stats">
            <p>Usu√°rios registrados: <span id="userCount">Carregando...</span></p>
        </div>
    </div>

<script>
    Parse.initialize("TYP8SUA8qxmHIRs1mHbiFalgRxCEf51sOiSWmNEY", "n4Gfko9sO7jiAUnWX5U5GGCDQ5QtPWX97K4TzB8I");
    Parse.serverURL = "https://parseapi.back4app.com";

    async function checkAdmin() {
        try {
            const user = Parse.User.current();
            if (!user) {
                throw new Error('Usu√°rio n√£o logado');
            }

            console.log('Iniciando verifica√ß√£o de admin...');
            
            // M√©todo 1: Cloud Function
            const isAdminCloud = await Parse.Cloud.run('isAdmin').catch(console.error);
            console.log('Resultado Cloud Function:', isAdminCloud);

            // M√©todo 2: Query direta
            const roleQuery = new Parse.Query(Parse.Role)
                .equalTo('name', 'admin')
                .equalTo('users', user);

            const isAdminLocal = await roleQuery.count() > 0;
            console.log('Resultado Local Query:', isAdminLocal);

            if (!isAdminCloud && !isAdminLocal) {
                throw new Error('Usu√°rio n√£o √© admin');
            }

            // Se passar, mostra conte√∫do
            document.getElementById('adminContent').classList.remove('hidden');
            document.getElementById('adminUsername').textContent = user.get('username');
            loadStats();

        } catch (error) {
            console.error('Erro cr√≠tico:', error);
            alert(`üî• ERRO: ${error.message}`);
            window.location.href = 'index.html';
        }
    }

    checkAdmin();
// Debug r√°pido
    async function debugAdminCheck() {
    const user = Parse.User.current();
    console.log('Usu√°rio atual:', user);
    
    const rolesQuery = new Parse.Query(Parse.Role)
        .equalTo('users', user)
        .select('name');
    
    const roles = await rolesQuery.find();
    console.log('Roles do usu√°rio:', roles.map(r => r.get('name')));
}

debugAdminCheck();
    
</script>
</body>
</html>
