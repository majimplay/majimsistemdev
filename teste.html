<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>üõí Base Sincroniza√ß√£o - Multi-Loja</title>
    <style>
        /* Estilos CSS (mantidos do original) */
        body {
            font-family: 'Arial', sans-serif;
            margin: 2rem; /* Added margin for better visibility */
            padding: 0;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }
        .profile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 2px solid #eee;
        }
        .profile-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #007BFF;
            margin-right: 2rem;
        }
        .profile-info h1 { margin: 0; color: #333; }
        .profile-info p { color: #666; margin: 0.5rem 0; }
        /* Removed cart, shipping, form styles as they are not directly relevant */
        .btn {
            padding: 0.8rem 1.5rem; border: none; border-radius: 6px; cursor: pointer;
            font-weight: 600; transition: all 0.3s ease; white-space: nowrap;
        }
        .btn-secondary { background: #6c757d; color: white; }
        .emoji { margin-right: 8px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://unpkg.com/parse/dist/parse.min.js"></script>
</head>
<body>

    <div class="container">
        <div class="profile-header">
            <div style="display: flex; align-items: center;">
                <img id="profilePhoto" class="profile-photo" src="https://placehold.co/120x120/eee/ccc?text=User" alt="Foto do Perfil">
                <div class="profile-info">
                    <h1 id="userName"><span class="emoji">üë§</span> Carregando...</h1>
                    <p id="userEmail"></p>
                </div>
            </div>
            <button id="logoutBtn" class="btn btn-secondary"><span class="emoji">üö™</span> Sair</button>
        </div>

        <h2>Informa√ß√µes do Usu√°rio (Teste)</h2>
        <p>usuario firebase nome id</p>
        <p>usuario Parce nome id</p>
        <p>tem loja nomedaloja ou nao tem loja .</p>
        </div>

    <script>
                // --- Configurations ---
        const firebaseConfig = {
            apiKey: "AIzaSyDlUQbbTP29VqBVmzOGHhfc67R1DTRPwxg", // Sua chave
            authDomain: "gitautenticatio.firebaseapp.com",
            databaseURL: "https://gitautenticatio-default-rtdb.firebaseio.com", // Mantido para CEP
            projectId: "gitautenticatio",
            storageBucket: "gitautenticatio.appspot.com",
            messagingSenderId: "21514234895",
            appId: "1:21514234895:web:d34dc4c44baf586d2cc77a"
        };

        // Initialize Firebase (Auth and DB for user CEP)
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Initialize Parse
        Parse.initialize("TYP8SUA8qxmHIRs1mHbiFalgRxCEf51sOiSWmNEY", "n4Gfko9sO7jiAUnWX5U5GGCDQ5QtPWX97K4TzB8I"); // Suas chaves
        Parse.serverURL = "https://parseapi.back4app.com/";

        // --- Global Variables ---
        let firebaseUser = null; // Firebase user object

        // --- Event Listeners and Initialization ---

        // Monitor Firebase auth state (Essential for Sync/Login)
        auth.onAuthStateChanged(async user => {
            if (user) {
                firebaseUser = user;
                console.log("Firebase user logged in:", firebaseUser.uid, firebaseUser.displayName);
                atualizarCabecalho(); // Update UI with user info

                const parseUser = Parse.User.current();
                if (parseUser) {
                    console.log("Parse user logged in:", parseUser.id, parseUser.get("username"));
                    // Aqui voc√™ pode adicionar l√≥gica para verificar se o usu√°rio Parse tem loja
                    // Exemplo: verificar um campo 'temLoja' ou 'nomeLoja' no objeto Parse User ou Cliente
                    verificarLojaParse(parseUser);
                } else {
                    console.warn("Firebase user logged in, but Parse.User.current() is null! Potential sync issue.");
                    // Tentar logar no Parse ou associar contas se necess√°rio
                }

            } else {
                firebaseUser = null;
                console.log("No Firebase user logged in. Redirecting or showing login...");
                // Optionally redirect to login page:
                // window.location.href = 'login.html';
                // Ou limpar a UI
                document.getElementById('userName').textContent = 'üë§ N√£o conectado';
                document.getElementById('userEmail').textContent = '';
                document.getElementById('profilePhoto').src = 'https://placehold.co/120x120/eee/ccc?text=?';
            }
        });

        // Logout Button (Essential for Login Management)
        const logoutButton = document.getElementById('logoutBtn');
        if (logoutButton) {
            logoutButton.addEventListener('click', async () => {
                try {
                    await auth.signOut(); // Logout Firebase
                    await Parse.User.logOut(); // Logout Parse
                    console.log("Logout successful.");
                    // Optionally redirect after logout
                    // window.location.href = 'login.html';
                } catch (error) {
                    console.error('Error during logout:', error);
                    alert('‚ùå Error logging out: ' + error.message);
                }
            });
        } else {
            console.warn("Logout button not found in the simplified HTML.");
        }


        // --- UI and Helper Functions ---

        // Update profile header (Relies on logged-in state)
        function atualizarCabecalho() {
            if (!firebaseUser) return;
            const profilePhoto = document.getElementById('profilePhoto');
            const userName = document.getElementById('userName');
            const userEmail = document.getElementById('userEmail');

            if (profilePhoto) profilePhoto.src = firebaseUser.photoURL || 'https://placehold.co/120x120/eee/ccc?text=:)';
            if (userName) userName.textContent = 'üë§ ' + (firebaseUser.displayName || 'Usu√°rio Firebase');
            if (userEmail) userEmail.textContent = 'üìß ' + firebaseUser.email;
        }

        // Fun√ß√£o exemplo para verificar loja no Parse (Adapte conforme sua estrutura)
        async function verificarLojaParse(parseUser) {
            // Exemplo 1: Se a informa√ß√£o est√° no pr√≥prio Parse.User
            const nomeLojaUser = parseUser.get("nomeLoja"); // Supondo um campo 'nomeLoja'
            if (nomeLojaUser) {
                 console.log(`Parse User tem loja: ${nomeLojaUser}`);
                 // Atualizar UI se necess√°rio
                 return;
            }

            // Exemplo 2: Se a informa√ß√£o est√° na classe 'Cliente' associada
            const Cliente = Parse.Object.extend("Cliente");
            const queryCliente = new Parse.Query(Cliente);
            queryCliente.equalTo("usuario", parseUser);
            queryCliente.select("nomeLoja"); // Selecionar apenas o campo necess√°rio
            try {
                const cliente = await queryCliente.first();
                if (cliente) {
                    const nomeLojaCliente = cliente.get("nomeLoja");
                    if (nomeLojaCliente) {
                        console.log(`Parse User (via Cliente) tem loja: ${nomeLojaCliente}`);
                         // Atualizar UI
                    } else {
                        console.log("Parse User (via Cliente) n√£o tem loja registrada.");
                         // Atualizar UI
                    }
                } else {
                    console.log("Nenhum objeto Cliente associado encontrado para o Parse User.");
                }
            } catch (error) {
                 console.error("Erro ao buscar dados da loja no Cliente Parse:", error);
            }
        }

        // --- Fun√ß√µes Omitidas (Carrinho, CEP, Frete, etc.) ---
        // As fun√ß√µes carregarCarrinho, removerDoCarrinho, carregarCEPSalvo,
        // buscarEndereco, calcularFreteMultiLoja, exibirFretePorLoja,
        // selecionarFrete, checkAllSelectionsMade, atualizarPrecoFinal,
        // prosseguirCheckout, formatarCEP, voltarParaIndex foram omitidas
        // por n√£o serem estritamente necess√°rias para a sincroniza√ß√£o/login inicial.

    </script>
</body>
</html>
